global:
  scrape_interval: 5s
  evaluation_interval: 5s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Scrape Prometheus's own metrics for demo visibility
  - job_name: "prometheus-internal"
    static_configs:
      - targets: ["localhost:9090"]
    metrics_path: "/metrics"

  # IoT Node Simulators - Scrape metrics from each node
  - job_name: "iot-nodes"
    static_configs:
      - targets:
          - "imperium-iot-node-1:8001"
          - "imperium-iot-node-2:8002"
          - "imperium-iot-node-3:8003"
          - "imperium-iot-node-4:8004"
          - "imperium-iot-node-5:8005"
          - "imperium-iot-node-6:8006"
          - "imperium-iot-node-7:8007"
          - "imperium-iot-node-8:8008"
          - "imperium-iot-node-9:8009"
          - "imperium-iot-node-10:8010"
        labels:
          group: "iot-simulators"
    relabel_configs:
      - source_labels: [__address__]
        regex: 'imperium-iot-node-(\d+):.*'
        target_label: node_number
        replacement: '${1}'

  # ESP32 DUAL NODE - Single ESP32 running both CO2 and Audio sensors
  # One endpoint exposes metrics for both logical devices:
  #   - co2_ppm{device="esp32-mhz19-1"}
  #   - audio_rms_level_db{device="esp32-audio-1"}
  - job_name: "esp32-dual-node"
    static_configs:
      - targets:
          - "10.218.189.218:8080"
        labels:
          type: "dual_sensor"
          group: "hardware-nodes"

  # CO2 Simulator/Collector (fallback when ESP32 offline)
  - job_name: "co2-collector"
    static_configs:
      - targets:
          - "host.docker.internal:8020"
        labels:
          device_id: "mhz19-01"
          type: "co2_collector"
          group: "simulators"
