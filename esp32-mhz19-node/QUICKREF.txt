â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ESP32 MH-Z19 CO2 SENSOR NODE                              â•‘
â•‘                   Complete Setup Created âœ“                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ PROJECT LOCATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
/home/imperium/Imperium/esp32-mhz19-node/

ğŸ”Œ HARDWARE WIRING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    MH-Z19 Sensor              ESP32 Board
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. HD       â”‚            â”‚             â”‚
    â”‚ 2. TX   â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ GPIO16 (RX2)â”‚
    â”‚ 3. RX   â—„â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ GPIO17 (TX2)â”‚
    â”‚ 4. -        â”‚            â”‚             â”‚
    â”‚ 5. -        â”‚            â”‚             â”‚
    â”‚ 6. VCC  â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ 5V (VIN)    â”‚
    â”‚ 7. GND  â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ GND         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸  CRITICAL: Use 5V (VIN), NOT 3.3V!

ğŸš€ QUICK START (ONE COMMAND)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
cd /home/imperium/Imperium/esp32-mhz19-node
./build_and_flash.sh

This will:
  âœ“ Check ESP-IDF installation
  âœ“ Detect ESP32 serial port
  âœ“ Configure WiFi & MQTT (interactive)
  âœ“ Build firmware
  âœ“ Flash to ESP32
  âœ“ Monitor output

ğŸ“‹ MANUAL BUILD STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Install ESP-IDF (if needed):
   $ mkdir -p ~/esp && cd ~/esp
   $ git clone --recursive https://github.com/espressif/esp-idf.git
   $ cd esp-idf && ./install.sh esp32
   $ source export.sh

2. Configure:
   $ ./setup_esp.sh
   (Enter WiFi SSID, password, MQTT broker IP)

3. Build:
   $ idf.py build

4. Flash:
   $ idf.py -p /dev/ttyUSB0 flash

5. Monitor:
   $ idf.py -p /dev/ttyUSB0 monitor
   (Press Ctrl+] to exit)

ğŸ“ PROJECT FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
main/
  â”œâ”€â”€ main.c              Main application & task management
  â”œâ”€â”€ mhz19.c/h           MH-Z19 sensor driver (UART comm)
  â”œâ”€â”€ wifi_handler.c/h    WiFi connection & reconnection
  â”œâ”€â”€ mqtt_handler.c/h    MQTT pub/sub & JSON handling
  â”œâ”€â”€ config.h            Configuration (WiFi, MQTT, pins)
  â””â”€â”€ CMakeLists.txt      Build configuration

Scripts:
  â”œâ”€â”€ build_and_flash.sh  â­ Complete automated build
  â”œâ”€â”€ setup_esp.sh        Configure WiFi/MQTT
  â””â”€â”€ flash.sh            Quick flash only

Documentation:
  â”œâ”€â”€ README.md           Full technical docs
  â”œâ”€â”€ QUICKSTART.md       Fast setup guide
  â”œâ”€â”€ INTEGRATION.md      Imperium integration
  â”œâ”€â”€ TROUBLESHOOTING.md  Debug guide
  â””â”€â”€ SETUP_COMPLETE.md   Summary (this file)

âœ¨ FEATURES IMPLEMENTED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Real-time CO2 measurement (0-5000 ppm)
âœ“ Temperature reading (internal sensor)
âœ“ 3-minute warm-up detection
âœ“ Configurable detection range (2000/5000/10000 ppm)
âœ“ Zero point calibration (400 ppm)
âœ“ Automatic Baseline Correction (ABC)
âœ“ WiFi connection with auto-reconnect
âœ“ MQTT publish/subscribe
âœ“ JSON telemetry format
âœ“ Remote control via MQTT commands
âœ“ Configurable publish interval (1s-5min)
âœ“ LED status indicator
âœ“ Watchdog timer & error handling

ğŸŒ MQTT INTEGRATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Subscribe:
  imperium/devices/esp32-mhz19-1/control  â†’ Commands
  imperium/devices/esp32-mhz19-1/config   â†’ Configuration

Publish:
  imperium/devices/esp32-mhz19-1/telemetry â†’ Sensor data
  imperium/devices/esp32-mhz19-1/status    â†’ Device status

ğŸ¯ TESTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Monitor telemetry
mosquitto_sub -h 192.168.1.100 -t "imperium/devices/esp32-mhz19-1/telemetry"

# Send command
mosquitto_pub -h 192.168.1.100 \
    -t "imperium/devices/esp32-mhz19-1/control" \
    -m '{"command":"GET_INFO"}'

# Test Imperium intent
curl -X POST http://localhost:5000/api/v1/intents \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" \
    -d '{"description":"Set publish interval to 10 seconds for esp32-mhz19-1"}'

ğŸ“Š CO2 LEVELS REFERENCE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  < 400 ppm    ğŸŒ³ Outdoor fresh air
  400-800 ppm  âœ… Good air quality
  800-1000 ppm âš ï¸  Acceptable
  1000-1500 ppm âš ï¸  Poor - increase ventilation
  1500-2000 ppm âš ï¸  Very poor - open windows
  > 2000 ppm   ğŸš¨ Dangerous - evacuate!

ğŸ›ï¸ SUPPORTED COMMANDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
SET_PUBLISH_INTERVAL  - Change telemetry rate (1000-300000 ms)
CALIBRATE_ZERO        - Zero calibration (in fresh air)
SET_DETECTION_RANGE   - Change range (2000/5000/10000 ppm)
SET_ABC               - Enable/disable auto baseline correction
GET_INFO              - Query sensor configuration

ğŸ”§ CONFIGURATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Edit main/config.h:
  â€¢ WiFi SSID/Password
  â€¢ MQTT Broker URL
  â€¢ Device ID
  â€¢ GPIO Pins
  â€¢ Default publish interval
  â€¢ Detection range
  â€¢ ABC settings

Or run: ./setup_esp.sh

ğŸš¨ COMMON ISSUES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Problem                  Solution
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sensor not responding    Check wiring, verify 5V, wait 3min
Flash failed             Press BOOT button, check USB cable
WiFi not connecting      Check SSID/password, use 2.4GHz
MQTT not connecting      Verify broker IP, test port 1883
Inaccurate readings      Calibrate in fresh air, enable ABC
Build errors             source ~/esp/esp-idf/export.sh

See TROUBLESHOOTING.md for detailed solutions.

ğŸ“š DOCUMENTATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
README.md            â†’ Complete technical documentation
QUICKSTART.md        â†’ Fast setup guide (5 steps)
INTEGRATION.md       â†’ Imperium system integration
TROUBLESHOOTING.md   â†’ Debug & problem-solving

ğŸ‰ READY TO BUILD!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Connect hardware (see wiring diagram above)
2. Run: ./build_and_flash.sh
3. Wait 3 minutes for sensor warm-up
4. Monitor telemetry via MQTT
5. Submit intents via Imperium API

Need help? See TROUBLESHOOTING.md or README.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Project created: 2026-02-12
Status: âœ… READY TO FLASH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
